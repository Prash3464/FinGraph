{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'assets/analytics.css' %}">
<link rel="stylesheet" href="{% static 'assets/popup.css' %}">
<!--<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>-->
{% endblock %}

{% block content %}
<div class="dark-theme">
  <div class="analytics-container">

    <!-- ðŸ”¹ SECTION 1: Graph + Filters -->
    <section class="analytics-graph-section">
      <div class="graph-header">
        <h2>Expense Overview</h2>
        <div class="graph-controls">
          <label for="analytics-month">Select Month:</label>
          <input type="month" id="analytics-month" name="month" value="{{ selected_month|default:now|date:'Y-m' }}">
          <select id="analytics-view-toggle" id="view-type"
            onchange="document.getElementById('analyticsForm').submit()">
            <option value="daily" {% if selected_view == "daily" %}selected{% endif %}>Daily View</option>
            <option value="monthly" {% if selected_view == "monthly" %}selected{%endif%}>Monthly View</option>
            <!--            <option value="yearly" {% if selected_view == "yearly" %}selected{%endif%}>Yearly View</option>-->
          </select>
        </div>
      </div>

      <div id="analytics-chart" class="chart-container">
        <!-- Plotly chart will render here -->
      </div>

    </section>

    <!-- ðŸ”¹ SECTION 2: Expense List -->
    <section class="analytics-expense-list-section">
      <div class="list-header">
        <h2>All Expenses</h2>
        <button id="add-expense-btn" title="Add New Expense">ï¼‹</button>
      </div>

      <div class="expenses-list">
        {% for expense in expenses_list %}
        <div class="expense-item">
          <div class="expense-main">
            <span class="expense-date">{{ expense.date }}</span>
            <span class="expense-title">{{ expense.title }}</span>
            <span class="expense-amount">â‚¹{{ expense.amount }}</span>
          </div>
          <div class="expense-actions">
            <button onclick="deleteExpense({{ expense.id }})" class="delete-btn">Delete</button>
          </div>
        </div>
        {% empty %}
        <p class="no-expenses">No expenses to show.</p>
        {% endfor %}
      </div>
    </section>

  </div>
  <div id="delete-confirm-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <p>Are you sure you want to delete this expense?</p>
      <div class="modal-buttons">
        <button id="confirm-delete-btn">Yes, Delete</button>
        <button onclick="closeDeleteModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
  window.analyticsLabels = {{ labels | safe }};
  window.analyticsTotals = {{ totals | safe }};
</script>


{% endblock %}
{% block add_scripts %}
<script src="{% static 'assets/analytics.js' %}"></script>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

{% endblock %}